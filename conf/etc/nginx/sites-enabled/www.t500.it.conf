fastcgi_cache_path /var/www/t500/www.t500.it/cache levels=1:2 keys_zone=www.t500.it:1m inactive=60m use_temp_path=off;

server {
	listen 80;
	listen [::]:80;

	server_name test.t500.it;
	
	# Custom Variable
	set $host_web	 "web";
	set $host_domain "www.t500.it";
	set $host_home	 "/var/www/t500/";
	set $host_user	 "t500";
	set $host_group  "www-data";
	set $host_fastcgi_pass	"172.17.0.1:7000";
	set $host_fastcgi_cache "www.t500.it";

	access_log /var/www/t500/www.t500.it/logs/test.t500.it-access.log;
	error_log /var/www/t500/www.t500.it/logs/test.t500.it-error.log;

	# Common
	include global/common.conf;

	# Exclusions
	include global/exclusions.conf;
	include global/exclusions-wp.conf;

	# Security
	include global/security.conf;

	# Static Content
	include global/static-files.conf;

	# SSL rules
	include global/ssl.conf;

	#FastCGI Cache
	include global/fastcgi-cache.conf;

	root /var/www/$host_user/$host_domain/public_html;
	index index.php index.html index.htm;
	
	rewrite ^/en$ /index.php?language=en&_route_=$1 last;
	rewrite ^/en/(.*)$ /index.php?language=en&_route_=$1 last;

	rewrite ^/fr$ /index.php?language=fr&_route_=$1 last;
	rewrite ^/fr/(.*)$ /index.php?language=fr&_route_=$1 last;

	rewrite ^/de$ /index.php?language=de&_route_=$1 last;
	rewrite ^/de/(.*)$ /index.php?language=de&_route_=$1 last;
	
	location /admin {
		try_files $uri $uri/ /index.php?$args;
	}

	location / {
		rewrite ^/$ /index.php?language=it&_route_=$1 last;
		rewrite ^/(.*)$ /index.php?language=it&_route_=$1 last;
	}

	location ~ \.php$ {
		try_files $uri = 404;
		include global/fastcgi-params.conf;
		fastcgi_intercept_errors on;

		#FastCGI Cache
		fastcgi_cache $host_domain;
		fastcgi_cache_key $host_fastcgi_cache;
		fastcgi_cache_valid 0m;
		fastcgi_no_cache 1;
		
		# Debug
		# include global/debug.conf;

		# PHP-FPM
		fastcgi_split_path_info ^(.+\.php)(/.+)$;
		fastcgi_pass	$host_fastcgi_pass;
		fastcgi_index	index.php;
	}
}